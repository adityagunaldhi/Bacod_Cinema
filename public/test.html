<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="axios" href="../node_modules/axios">
  <!-- <script src="../node_modules/axios"></script> -->
  <title>Pemilihan Seat Bioskop</title>
  <style>
  </style>
</head>
<body>
  <div class="book-tickets">
    
      <div class="tickets">
        <div class="tickets-tittle">
          <h1 id="movie_title">Judul Film</h1>
        </div>
        <div class="tickets-screen">LAYAR</div>
        <div class="tickets-seats">
          <!-- Kursi akan di-generate oleh JavaScript -->
        </div>
      </div>
      <div class="book" id="showtimes-list">
        <h2>Detail Pesanan</h2>
              
      </div>
    
  </div>

  <script>
    const seatsContainer = document.querySelector('.tickets-seats');
    const selectedSeatsDisplay = document.getElementById('selected-seats');
    const totalSeatsDisplay = document.getElementById('total-seats');

    const rows = ['A','B','C','D','E','F','G','H'];
    const cols = 8;

    rows.forEach(row => {
      for (let col = 1; col <= cols; col++) {
        const seatLabel = `${row}${col}`;
        const seat = document.createElement('div');
        seat.classList.add('seat');
        seat.setAttribute('data-seat', seatLabel);
        seat.textContent = seatLabel;
        seatsContainer.appendChild(seat);
      }
    });

    seatsContainer.addEventListener('click', (e) => {
      if (e.target.classList.contains('seat')) {
        e.target.classList.toggle('selected');
        updateSelectedSeats();
      }
    });

    function updateSelectedSeats() {
      const selectedSeats = document.querySelectorAll('.seat.selected');
      const selectedLabels = [...selectedSeats].map(seat => seat.getAttribute('data-seat'));
      selectedSeatsDisplay.textContent = selectedLabels.length ? selectedLabels.join(', ') : '';
      totalSeatsDisplay.textContent = selectedSeats.length;
    }    

    axios.get("http://localhost:5000/api/showtimes")
      .then((response) => {
        const dataShowtimes = response.showtimes
        const showtimesHTML = "";

        dataShowtimes.forEach((showtimes) => {
          showtimesHTML +=`
          <div>
            <div class="card">
              <img src="${showtimes.poster_image}" class="card-img-top">
              <div class="card-body">
                <h5 class="card-title">${showtimes.movie_title}</h5>
              </div>
            </div>
          </div>   
          <div class="booked">
            <table class="table-transactions">
              <tr>
                <td id="total-seats" width="100px">JumlahTiket</td>
                <td id="selected-seats">Nomor Kursi</td>
              </tr>
              <tr>
                <td width="100px">Harga</td>
                <td class="price">${showtimes.price}</td>
              </tr>
              <tr>
                <td colspan="2">x</td>
              </tr>
              <tr>
                <td id="total-seats" colspan="2">JumlahTiket</td>
              </tr>
              <tr>
                <td class="final-price">
                  <b>Total</b>
                </td>
                <td class="final-price">
                  <b>Rp. 0</b>
                </td>
              </tr>
            </table>            
            <button type="button" id="order-button" onclick="kirimKeBackend()">
              ORDER
            </button>
          </div>`
          });
          document.getElementById("showtimes-list")
        })

    async function loadShowtimes() {
      try {
        const response = await fetch('http://localhost:5000/api/showtimes/1');
        const data = await response.json();
        console.log(data);    
        const showtimesList = document.getElementById("showtimes-list");
          showtimesList.innerHTML = "";    

        // if (data.showtimes && Array.isArray(data.showtimes)) {
        //   const showtimesList = document.getElementById("showtimes-list");
        //   showtimesList.innerHTML = "";

        //   const showtimeCards = data.showtimes.map(showtime => {
        //     return `
        //       <div class="col-md-4 mb-4">
        //         <div class="card" onclick="openBookingModal(${showtime.showtime_id}, '${showtime.movie_title}', ${showtime.price})">
        //           <img src="${showtime.poster_image}" class="card-img-top" alt="${showtime.movie_title}">
        //           <div class="card-body">
        //             <h5 class="card-title">${showtime.movie_title}</h5>
        //             <p class="card-text">Start: ${new Date(showtime.start_time).toLocaleString()}</p>
        //             <p class="card-text">End: ${new Date(showtime.end_time).toLocaleString()}</p>
        //             <p class="card-text">Price: $${showtime.price}</p>
        //           </div>
        //         </div>
        //       </div>
        //     `;
        //   });

        //   showtimesList.innerHTML = showtimeCards.join('');
        // } else {
        //   console.error("Invalid data format:", data);
        //   alert("Error: Invalid data format received from the server.");
        // }
      } catch (error) {
        console.error("Error loading showtimes:", error);
        alert("Failed to load showtimes. Please try again later.");
      };
    };

    window.onload = loadShowtimes;

  </script>
</body>
</html>